# PRD: 会話サンプル機能
*Product Requirements Document*

## エグゼクティブサマリー

### 概要
Character Bankのプロンプトに「会話サンプル」を追加し、ユーザーが実際のキャラクターとの対話をイメージしやすくする機能。

### 問題定義
現在、プロンプトの説明文だけでは、キャラクターがどのような話し方・性格なのかを十分に伝えることができず、ユーザーのプロンプト選択率が低い。

### ソリューション
プロンプト作成者が最大5個の会話例（ユーザー発言→キャラクター返答）を追加できるようにし、プロンプトカードと詳細ページで表示する。

## ビジネス目標

### 主要目標
- プロンプトの使用率を30%向上
- ユーザーエンゲージメントの向上

### 成功指標（KPI）
| 指標 | 現在値 | 目標値 | 測定方法 |
|------|--------|--------|----------|
| カード→詳細ページ遷移率 | 20% | 35% | Google Analytics |
| 詳細ページ→コピー率 | 15% | 30% | カスタムイベント |
| 例付きプロンプトの平均いいね数 | 10 | 20 | DBクエリ |
| 作成者の例追加率 | 0% | 60% | DBクエリ |

## ユーザーストーリー

### プロンプト作成者として
- プロンプトの魅力を具体的に伝えたい
- キャラクターの話し方を実例で示したい
- より多くの人に使ってもらいたい

### プロンプト利用者として
- 使用前にキャラクターの雰囲気を知りたい
- どんな会話ができるか具体例を見たい
- 自分のニーズに合うか判断したい

## 機能要件

### データモデル
```typescript
// promptsテーブルに追加
examples: v.optional(v.array(v.object({
  id: v.string(),
  userMessage: v.string(),           // 最大200文字
  characterResponse: v.string(),      // 最大500文字
  scenario: v.optional(v.string()),   // 最大50文字
  createdAt: v.number(),
  isHighlighted: v.optional(v.boolean()),
}))),
exampleCount: v.optional(v.number()), // 0-5
```

### 制約事項
- 1プロンプトあたり最大5個の例
- ユーザーメッセージ: 最大200文字
- キャラクター返答: 最大500文字
- 場面説明: 最大50文字

### API設計
| エンドポイント | メソッド | 説明 |
|--------------|---------|------|
| prompts.addExample | Mutation | 例を追加 |
| prompts.updateExample | Mutation | 例を更新 |
| prompts.deleteExample | Mutation | 例を削除 |
| prompts.reorderExamples | Mutation | 例の順序変更 |

## UI/UX要件

### プロンプトカード
- 最初の2例のみ表示
- 文字数制限で省略表示
- 「+n個の例」リンク

### 詳細ページ
- 全例を表示
- チャット風UI
- 場面タグ表示

### 作成・編集フォーム
- ドラッグ&ドロップで順序変更
- リアルタイムプレビュー
- 文字数カウンター

## 非機能要件

### パフォーマンス
- カード表示: 追加レイテンシ < 50ms
- 詳細ページ: 追加レイテンシ < 100ms
- データサイズ: 1例あたり最大1KB

### セキュリティ
- XSS対策: すべての入力をサニタイズ
- 文字数制限: サーバー側で検証
- レート制限: 1分あたり10例まで

### アクセシビリティ
- スクリーンリーダー対応
- キーボードナビゲーション
- ARIA属性の適切な使用

## 実装計画

### Phase 1: MVP (2週間)
**Week 1**
- [ ] データベーススキーマ更新
- [ ] Convex関数実装
- [ ] 基本的なCRUD API

**Week 2**
- [ ] プロンプトカードUI
- [ ] 詳細ページUI
- [ ] 作成フォームUI

### Phase 2: 機能強化 (1週間)
- [ ] ドラッグ&ドロップ
- [ ] リアルタイムプレビュー
- [ ] 例のハイライト機能

### Phase 3: 最適化 (1週間)
- [ ] パフォーマンス最適化
- [ ] モバイル最適化
- [ ] A/Bテスト実装

## リスクと軽減策

| リスク | 影響度 | 発生確率 | 軽減策 |
|--------|--------|----------|--------|
| 不適切なコンテンツ | 高 | 中 | 報告機能、モデレーション |
| データ量増加 | 中 | 高 | 文字数制限、圧縮 |
| 複雑性増加 | 中 | 中 | 段階的リリース |
| 低採用率 | 高 | 低 | UI改善、インセンティブ |

## ロールバックプラン

1. **機能フラグ**: 例表示のON/OFF切り替え
2. **データ保持**: 削除せず非表示化
3. **段階的無効化**: 新規追加停止→表示停止→完全削除

## 関係者

| 役割 | 担当者 | 責任範囲 |
|------|--------|----------|
| プロダクトオーナー | TBD | 最終承認、優先順位決定 |
| 開発リード | TBD | 技術設計、実装 |
| UIデザイナー | TBD | UI/UX設計 |
| QAエンジニア | TBD | テスト計画、実行 |

## 承認

- [ ] プロダクトオーナー承認
- [ ] 技術リード承認
- [ ] デザインリード承認

---

*最終更新: 2024-06-16*
*バージョン: 1.0*